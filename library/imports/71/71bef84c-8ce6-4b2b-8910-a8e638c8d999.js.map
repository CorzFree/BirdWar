{"version":3,"sources":["../../../../../../assets/common/script/basic/assets/common/script/basic/gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","on","eventType","roundOver","leaveRoomNotify","leaveRoom","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","uiFunc","openUI","obj","active","data","dispatch","leaveRoomMedNotify","console","log","gameState","GameState","Play","leaveRoomInfo","owner","userInfo","id","isRoomOwner","friends","friendIds","filter","x","userId","length","friendCnt","gameOver","loseCamp","Camp","Friend","uiVsResult","enemyIds","selfScore","enemyHearts","rivalScore","friendHearts","setData","bind","enemyCnt","Enemy","curRound","None","timeOver","Over","sendRoundStartMsg","startGame","readyCnt","loadScene","sendReadyMsg","sendRoundOverMsg","msg","action","ROUND_OVER","sendEventEx","ROUND_START","READY","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","networkStateNotify","result","engine","channel","platform","gameId","netNotify","kickPlayerRsp","status","rsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","disconnect","removePersistRootNode","error","uiTip","logout","registerUser","deviceId","gatewayId","login","token","gameVersion","appKey","secret","info","lobbyShow","Canvas","instance","designResolution","height","width","cpProto","JSON","parse","indexOf","GAME_START_EVENT","remoteUserIds","userIds","selfCamp","index","camp","push","playerUserIds","concat","player","PLAYER_FLY_EVENT","PlayerManager","getPlayerByUserId","srcUserId","flyNotify","PLAYER_FIRE_EVENT","i","j","playerId","fireNotify","bulletPointY","NEW_ITEM_EVENT","ItemManager","spawnItemNotify","PLAYER_GET_ITEM_EVENT","getItemNotify","PLAYER_REMOVE_ITEM_EVENT","removeItemNotify","PLAYER_HURT_EVENT","hurtNotify","murderId","getLoseCamp","loseCamp1","roundStart","TIME_OVER","m","dead","stringify","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","send","nickName","avatarUrl","userInfoReq","onDestroy","off"],"mappings":"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","file":"gameManager.js","sourceRoot":"../../../../../../assets/common/script/basic","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    blockInput() {\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\n        setTimeout(function() {\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\n        }, 1000);\n    },\n    onLoad() {\n        Game.GameManager = this;\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getCollisionManager().enabled = true;\n        clientEvent.init();\n        dataFunc.loadConfigs();\n        cc.view.enableAutoFullScreen(false);\n        clientEvent.on(clientEvent.eventType.roundOver, this.roundOver, this);\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        this.network = window.network;\n        network.chooseNetworkMode();\n        this.getRankDataListener();\n        this.findPlayerByAccountListener();\n\n\n        uiFunc.openUI(\"uiTip\", function(obj) {\n            obj.active = false;\n        });\n    },\n\n    leaveRoom: function(data) {\n        // 离开房间--\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, data);\n        console.log(\"离开房间\");\n        if (this.gameState === GameState.Play) {\n            if (data.leaveRoomInfo.owner === GLB.userInfo.id) {\n                GLB.isRoomOwner = true;\n            }\n            var friends = this.friendIds.filter(function(x) {\n                return x === data.leaveRoomInfo.userId;\n            });\n\n            if (friends.length > 0) {\n                this.friendCnt--;\n                if (this.friendCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Friend});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            } else {\n                this.enemyCnt--;\n                if (this.enemyCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Enemy});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            }\n        }\n    },\n\n    roundOver: function(data) {\n        this.curRound++;\n        switch (data.loseCamp) {\n            case Camp.Friend:\n                this.friendHearts -= 1;\n                break;\n            case Camp.Enemy:\n                this.enemyHearts -= 1;\n                break;\n            case Camp.None:\n                this.enemyHearts -= 1;\n                this.friendHearts -= 1;\n                break;\n        }\n\n        if (this.enemyHearts > 0 && this.friendHearts > 0 && data.loseCamp === Camp.None) {\n            clientEvent.dispatch(clientEvent.eventType.timeOver);\n        }\n\n        if (this.enemyHearts <= 0 || this.friendHearts <= 0) {\n            // 结算界面--\n            this.gameState = GameState.Over;\n            var loseCamp = Camp.None;\n            if (this.enemyHearts <= 0 && this.friendHearts <= 0) {\n                loseCamp = Camp.None;\n            } else if (this.enemyHearts <= 0) {\n                loseCamp = Camp.Enemy;\n            } else {\n                loseCamp = Camp.Friend;\n            }\n            clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: loseCamp});\n            setTimeout(function() {\n                uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                    var uiVsResult = obj.getComponent(\"uiVsResult\");\n                    data = {\n                        friendIds: this.friendIds,\n                        enemyIds: this.enemyIds,\n                        selfScore: 3 - this.enemyHearts,\n                        rivalScore: 3 - this.friendHearts\n                    }\n                    uiVsResult.setData(data);\n                }.bind(this))\n            }.bind(this), 1500);\n\n        } else if (GLB.isRoomOwner) {\n            // 下一回合--\n            setTimeout(function() {\n                this.sendRoundStartMsg();\n            }.bind(this), 3000);\n        }\n    },\n\n    startGame: function() {\n        this.friendHearts = 3;\n        this.enemyHearts = 3;\n        this.curRound = 1;\n        this.readyCnt = 0;\n        this.friendCnt = this.friendIds.length;\n        this.enemyCnt = this.enemyIds.length;\n\n        cc.director.loadScene('game', function() {\n            uiFunc.openUI(\"uiGamePanel\", function() {\n                this.sendReadyMsg();\n            }.bind(this));\n        }.bind(this));\n    },\n\n    sendRoundOverMsg: function(loseCamp) {\n        var msg = {action: GLB.ROUND_OVER, loseCamp: loseCamp};\n        this.sendEventEx(msg);\n    },\n\n    sendRoundStartMsg: function() {\n        var msg = {action: GLB.ROUND_START};\n        this.sendEventEx(msg);\n    },\n\n    sendReadyMsg: function() {\n        var msg = {action: GLB.READY};\n        this.sendEventEx(msg);\n    },\n\n    matchVsInit: function() {\n        mvs.response.initResponse = this.initResponse.bind(this);\n        mvs.response.errorResponse = this.errorResponse.bind(this);\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\n        mvs.response.networkStateNotify = this.networkStateNotify.bind(this);\n\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\n        if (result !== 0) {\n            console.log('初始化失败,错误码:' + result);\n        }\n        Game.GameManager.blockInput();\n\n    },\n\n    networkStateNotify: function(netNotify) {\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, netNotify);\n    },\n\n    kickPlayerNotify: function(kickPlayerNotify) {\n        var data = {\n            kickPlayerNotify: kickPlayerNotify\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\n    },\n\n    kickPlayerResponse: function(kickPlayerRsp) {\n        if (kickPlayerRsp.status !== 200) {\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\n            return;\n        }\n        var data = {\n            kickPlayerRsp: kickPlayerRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\n    },\n\n    getRoomListExResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\n    },\n\n    getRoomDetailResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\n    },\n\n    getRoomListResponse: function(status, roomInfos) {\n        if (status !== 200) {\n            console.log(\"失败 status:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomInfos: roomInfos\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\n    },\n\n    createRoomResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 createRoomResponse:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\n    },\n\n    joinOverResponse: function(joinOverRsp) {\n        if (joinOverRsp.status !== 200) {\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\n            return;\n        }\n        var data = {\n            joinOverRsp: joinOverRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\n    },\n\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\n        if (status !== 200) {\n            console.log(\"失败 joinRoomResponse:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomUserInfoList: roomUserInfoList,\n            roomInfo: roomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\n    },\n\n    joinRoomNotify: function(roomUserInfo) {\n        var data = {\n            roomUserInfo: roomUserInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\n    },\n\n    leaveRoomResponse: function(leaveRoomRsp) {\n        if (leaveRoomRsp.status !== 200) {\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\n            return;\n        }\n        var data = {\n            leaveRoomRsp: leaveRoomRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\n    },\n\n    leaveRoomNotify: function(leaveRoomInfo) {\n        var data = {\n            leaveRoomInfo: leaveRoomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\n    },\n\n    logoutResponse: function(status) {\n        Game.GameManager.network.disconnect();\n        cc.game.removePersistRootNode(this.node);\n        cc.director.loadScene('lobby');\n    },\n\n    errorResponse: function(error, msg) {\n        if (error === 1001 || error === 0) {\n            uiFunc.openUI(\"uiTip\", function(obj) {\n                var uiTip = obj.getComponent(\"uiTip\");\n                if (uiTip) {\n                    uiTip.setData(\"网络断开连接\");\n                }\n            });\n            setTimeout(function() {\n                mvs.engine.logout(\"\");\n                cc.game.removePersistRootNode(this.node);\n                cc.director.loadScene('lobby');\n            }.bind(this), 2500);\n        }\n        console.log(\"错误信息：\" + error);\n        console.log(\"错误信息：\" + msg);\n    },\n\n    initResponse: function() {\n        console.log('初始化成功，开始注册用户');\n        var result = mvs.engine.registerUser();\n        if (result !== 0) {\n            console.log('注册用户失败，错误码:' + result);\n        } else {\n            console.log('注册用户成功');\n        }\n    },\n\n    registerUserResponse: function(userInfo) {\n        var deviceId = 'abcdef';\n        var gatewayId = 0;\n        GLB.userInfo = userInfo;\n\n        console.log('开始登录,用户Id:' + userInfo.id)\n\n        var result = mvs.engine.login(\n            userInfo.id, userInfo.token,\n            GLB.gameId, GLB.gameVersion,\n            GLB.appKey, GLB.secret,\n            deviceId, gatewayId\n        );\n        if (result !== 0) {\n            console.log('登录失败,错误码:' + result);\n        }\n    },\n\n    loginResponse: function(info) {\n        if (info.status !== 200) {\n            console.log('登录失败,异步回调错误码:' + info.status);\n        } else {\n            console.log('登录成功');\n            this.lobbyShow();\n        }\n    },\n\n    lobbyShow: function() {\n        this.gameState = GameState.None;\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiLobbyPanelVer\");\n        } else {\n            uiFunc.openUI(\"uiLobbyPanel\");\n        }\n    },\n\n    // 玩家行为通知--\n    sendEventNotify: function(info) {\n        var cpProto = JSON.parse(info.cpProto);\n\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\n            // 分队--\n            if (remoteUserIds.length % 2 !== 0) {\n                return console.log(\"人数不为偶数, 无法开战！\");\n            }\n            var selfCamp = 0;\n            var index;\n            for (index = 0; index < remoteUserIds.length; index++) {\n                if (GLB.userInfo.id === remoteUserIds[index]) {\n                    if (index < remoteUserIds.length / 2) {\n                        selfCamp = 0;\n                    } else {\n                        selfCamp = 1;\n                    }\n                    break;\n                }\n            }\n            this.enemyIds = [];\n            this.friendIds = [GLB.userInfo.id];\n            for (index = 0; index < remoteUserIds.length; index++) {\n                var camp = 0;\n                if (index < remoteUserIds.length / 2) {\n                    camp = 0;\n                } else {\n                    camp = 1;\n                }\n                if (camp === selfCamp) {\n                    if (remoteUserIds[index] !== GLB.userInfo.id) {\n                        this.friendIds.push(remoteUserIds[index]);\n                    }\n                } else {\n                    this.enemyIds.push(remoteUserIds[index]);\n                }\n            }\n            GLB.playerUserIds = this.friendIds.concat(this.enemyIds);\n            console.log(\"remoteUserIds:\" + remoteUserIds);\n            console.log(\"GLB.playerUserIds:\" + GLB.playerUserIds);\n\n            this.startGame();\n        }\n\n        var player = null;\n        if (info.cpProto.indexOf(GLB.PLAYER_FLY_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.flyNotify();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_FIRE_EVENT) >= 0) {\n            for (var i = 0; i < GLB.playerUserIds.length; i++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[i]);\n                if (player) {\n                    for (var j = 0; j < cpProto.data.length; j++) {\n                        if (cpProto.data[j].playerId === player.userId) {\n                            player.fireNotify(cpProto.data[j].bulletPointY);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.NEW_ITEM_EVENT) >= 0) {\n            Game.ItemManager.spawnItemNotify(cpProto);\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_GET_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n            if (player) {\n                player.getItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_REMOVE_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.removeItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_HURT_EVENT) >= 0) {\n            if (Game.GameManager.gameState !== GameState.Over) {\n                player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n                if (player) {\n                    player.hurtNotify(cpProto.murderId);\n                }\n                // 检查回合结束--\n                var loseCamp = Game.PlayerManager.getLoseCamp();\n                if (loseCamp != null) {\n                    Game.GameManager.gameState = GameState.Over\n                    if (GLB.isRoomOwner) {\n                        this.sendRoundOverMsg(loseCamp);\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            // 如果发送方为敌方--\n            var loseCamp1 = cpProto.loseCamp;\n            if (this.friendIds.indexOf(info.srcUserId) < 0) {\n                if (loseCamp1 === Camp.Friend) {\n                    loseCamp1 = Camp.Enemy;\n                } else if (loseCamp1 === Camp.Enemy) {\n                    loseCamp1 = Camp.Friend;\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: loseCamp1});\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\n            Game.GameManager.gameState = GameState.Play;\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\n        }\n\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\n            this.readyCnt++;\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\n                this.sendRoundStartMsg();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.TIME_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            for (var m = 0; m < GLB.playerUserIds.length; m++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[m]);\n                if (player) {\n                    player.dead();\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: Camp.None});\n        }\n    },\n\n    sendEventEx: function(msg) {\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    },\n\n    getRankDataListener: function() {\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\n                uiRankPanel.setData(recvMsg.rankArray);\n            });\n        }.bind(this));\n    },\n\n    findPlayerByAccountListener: function() {\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\n        });\n    },\n\n    loginServer: function() {\n        if (!this.network.isConnected()) {\n            this.network.connect(GLB.IP, GLB.PORT, function() {\n                    this.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        this.network.send(\"connector.rankHandler.updateScore\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game0\"\n                        });\n                    }.bind(this), 500);\n\n                }.bind(this)\n            );\n        } else {\n            this.network.send(\"connector.rankHandler.updateScore\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game0\"\n            });\n        }\n    },\n\n    userInfoReq: function(userId) {\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                            \"account\": userId + \"\",\n                        });\n                    }, 200);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                \"account\": userId + \"\",\n            });\n        }\n    },\n\n    onDestroy() {\n        clientEvent.off(clientEvent.eventType.roundOver, this.roundOver, this);\n    }\n});\n"]}