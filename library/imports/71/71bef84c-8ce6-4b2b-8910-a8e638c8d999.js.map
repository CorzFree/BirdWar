{"version":3,"sources":["../../../../../../assets/common/script/basic/assets/common/script/basic/gameManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","blockInput","Game","GameManager","getComponent","BlockInputEvents","enabled","setTimeout","node","onLoad","game","addPersistRootNode","director","getCollisionManager","clientEvent","init","dataFunc","loadConfigs","view","enableAutoFullScreen","on","eventType","roundOver","leaveRoomNotify","leaveRoom","network","window","chooseNetworkMode","getRankDataListener","findPlayerByAccountListener","data","dispatch","leaveRoomMedNotify","console","log","gameState","GameState","Play","leaveRoomInfo","owner","userInfo","id","isRoomOwner","friends","friendIds","filter","x","userId","length","friendCnt","gameOver","loseCamp","Camp","Friend","uiFunc","openUI","obj","uiVsResult","enemyIds","selfScore","enemyHearts","rivalScore","friendHearts","setData","bind","enemyCnt","Enemy","curRound","None","timeOver","Over","sendRoundStartMsg","startGame","readyCnt","loadScene","sendReadyMsg","sendRoundOverMsg","msg","action","ROUND_OVER","sendEventEx","ROUND_START","READY","matchVsInit","response","initResponse","errorResponse","joinRoomResponse","joinRoomNotify","leaveRoomResponse","joinOverResponse","createRoomResponse","getRoomListResponse","getRoomDetailResponse","getRoomListExResponse","kickPlayerResponse","kickPlayerNotify","registerUserResponse","loginResponse","logoutResponse","sendEventNotify","networkStateNotify","result","engine","channel","platform","gameId","netNotify","kickPlayerRsp","status","rsp","roomInfos","joinOverRsp","roomUserInfoList","roomInfo","roomUserInfo","leaveRoomRsp","disconnect","removePersistRootNode","error","uiTip","logout","registerUser","deviceId","gatewayId","login","token","gameVersion","appKey","secret","info","lobbyShow","Canvas","instance","designResolution","height","width","cpProto","JSON","parse","indexOf","GAME_START_EVENT","remoteUserIds","userIds","selfCamp","index","camp","push","playerUserIds","concat","player","PLAYER_FLY_EVENT","PlayerManager","getPlayerByUserId","srcUserId","flyNotify","PLAYER_FIRE_EVENT","i","j","playerId","fireNotify","bulletPointY","NEW_ITEM_EVENT","ItemManager","spawnItemNotify","PLAYER_GET_ITEM_EVENT","getItemNotify","PLAYER_REMOVE_ITEM_EVENT","removeItemNotify","PLAYER_HURT_EVENT","hurtNotify","murderId","getLoseCamp","loseCamp1","roundStart","TIME_OVER","m","dead","stringify","recvMsg","uiRankPanel","rankArray","playerAccountGet","loginServer","isConnected","connect","IP","PORT","send","nickName","avatarUrl","userInfoReq","onDestroy","off"],"mappings":"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","file":"gameManager.js","sourceRoot":"../../../../../../assets/common/script/basic","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    blockInput() {\n        Game.GameManager.getComponent(cc.BlockInputEvents).enabled = true;\n        setTimeout(function() {\n            Game.GameManager.node.getComponent(cc.BlockInputEvents).enabled = false;\n        }, 1000);\n    },\n    onLoad() {\n        Game.GameManager = this;\n        cc.game.addPersistRootNode(this.node);\n        cc.director.getCollisionManager().enabled = true;\n        clientEvent.init();\n        dataFunc.loadConfigs();\n        cc.view.enableAutoFullScreen(false);\n        clientEvent.on(clientEvent.eventType.roundOver, this.roundOver, this);\n        clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoom, this);\n        this.network = window.network;\n        network.chooseNetworkMode();\n        this.getRankDataListener();\n        this.findPlayerByAccountListener();\n\n        // try {\n        //     wx.login({\n        //         success: function() {\n        //             wx.getUserInfo({\n        //                 fail: function(res) {\n        //                     // iOS 和 Android 对于拒绝授权的回调 errMsg 没有统一，需要做一下兼容处理\n        //                     if (res.errMsg.indexOf('auth deny') > -1 || res.errMsg.indexOf('auth denied') > -1) {\n        //                         // 处理用户拒绝授权的情况\n        //                         console.log(\"fail\");\n        //                     }\n        //                 },\n        //                 success: function(res) {\n        //                     Game.GameManager.nickName = res.userInfo.nickName;\n        //                     Game.GameManager.avatarUrl = res.userInfo.avatarUrl;\n        //                     console.log('success', Game.GameManager.nickName);\n        //                 }\n        //             });\n        //         }\n        //     })\n        // } catch (e) {\n        //\n        // }\n    },\n\n    leaveRoom: function(data) {\n        // 离开房间--\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, data);\n        console.log(\"离开房间\");\n        if (this.gameState === GameState.Play) {\n            if (data.leaveRoomInfo.owner === GLB.userInfo.id) {\n                GLB.isRoomOwner = true;\n            }\n            var friends = this.friendIds.filter(function(x) {\n                return x === data.leaveRoomInfo.userId;\n            });\n\n            if (friends.length > 0) {\n                this.friendCnt--;\n                if (this.friendCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Friend});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            } else {\n                this.enemyCnt--;\n                if (this.enemyCnt === 0) {\n                    clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: Camp.Enemy});\n                    setTimeout(function() {\n                        uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                            var uiVsResult = obj.getComponent(\"uiVsResult\");\n                            data = {\n                                friendIds: this.friendIds,\n                                enemyIds: this.enemyIds,\n                                selfScore: 3 - this.enemyHearts,\n                                rivalScore: 3 - this.friendHearts\n                            }\n                            uiVsResult.setData(data);\n                        }.bind(this))\n                    }.bind(this), 1500);\n                }\n            }\n        }\n    },\n\n    roundOver: function(data) {\n        this.curRound++;\n        switch (data.loseCamp) {\n            case Camp.Friend:\n                this.friendHearts -= 1;\n                break;\n            case Camp.Enemy:\n                this.enemyHearts -= 1;\n                break;\n            case Camp.None:\n                this.enemyHearts -= 1;\n                this.friendHearts -= 1;\n                break;\n        }\n\n        if (this.enemyHearts > 0 && this.friendHearts > 0 && data.loseCamp === Camp.None) {\n            clientEvent.dispatch(clientEvent.eventType.timeOver);\n        }\n\n        if (this.enemyHearts <= 0 || this.friendHearts <= 0) {\n            // 结算界面--\n            this.gameState = GameState.Over;\n            var loseCamp = Camp.None;\n            if (this.enemyHearts <= 0 && this.friendHearts <= 0) {\n                loseCamp = Camp.None;\n            } else if (this.enemyHearts <= 0) {\n                loseCamp = Camp.Enemy;\n            } else {\n                loseCamp = Camp.Friend;\n            }\n            clientEvent.dispatch(clientEvent.eventType.gameOver, {loseCamp: loseCamp});\n            setTimeout(function() {\n                uiFunc.openUI(\"uiVsResultVer\", function(obj) {\n                    var uiVsResult = obj.getComponent(\"uiVsResult\");\n                    data = {\n                        friendIds: this.friendIds,\n                        enemyIds: this.enemyIds,\n                        selfScore: 3 - this.enemyHearts,\n                        rivalScore: 3 - this.friendHearts\n                    }\n                    uiVsResult.setData(data);\n                }.bind(this))\n            }.bind(this), 1500);\n\n        } else if (GLB.isRoomOwner) {\n            // 下一回合--\n            setTimeout(function() {\n                this.sendRoundStartMsg();\n            }.bind(this), 3000);\n        }\n    },\n\n    startGame: function() {\n        this.friendHearts = 3;\n        this.enemyHearts = 3;\n        this.curRound = 1;\n        this.readyCnt = 0;\n        this.friendCnt = this.friendIds.length;\n        this.enemyCnt = this.enemyIds.length;\n\n        cc.director.loadScene('game', function() {\n            uiFunc.openUI(\"uiGamePanel\", function() {\n                this.sendReadyMsg();\n            }.bind(this));\n        }.bind(this));\n    },\n\n    sendRoundOverMsg: function(loseCamp) {\n        var msg = {action: GLB.ROUND_OVER, loseCamp: loseCamp};\n        this.sendEventEx(msg);\n    },\n\n    sendRoundStartMsg: function() {\n        var msg = {action: GLB.ROUND_START};\n        this.sendEventEx(msg);\n    },\n\n    sendReadyMsg: function() {\n        var msg = {action: GLB.READY};\n        this.sendEventEx(msg);\n    },\n\n    matchVsInit: function() {\n        mvs.response.initResponse = this.initResponse.bind(this);\n        mvs.response.errorResponse = this.errorResponse.bind(this);\n        mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);\n        mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);\n        mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);\n        mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);\n        mvs.response.joinOverResponse = this.joinOverResponse.bind(this);\n        mvs.response.createRoomResponse = this.createRoomResponse.bind(this);\n        mvs.response.getRoomListResponse = this.getRoomListResponse.bind(this);\n        mvs.response.getRoomDetailResponse = this.getRoomDetailResponse.bind(this);\n        mvs.response.getRoomListExResponse = this.getRoomListExResponse.bind(this);\n        mvs.response.kickPlayerResponse = this.kickPlayerResponse.bind(this);\n        mvs.response.kickPlayerNotify = this.kickPlayerNotify.bind(this);\n        mvs.response.registerUserResponse = this.registerUserResponse.bind(this);\n        mvs.response.loginResponse = this.loginResponse.bind(this); // 用户登录之后的回调\n        mvs.response.logoutResponse = this.logoutResponse.bind(this); // 用户登录之后的回调\n        mvs.response.sendEventNotify = this.sendEventNotify.bind(this);\n        mvs.response.networkStateNotify = this.networkStateNotify.bind(this);\n\n        var result = mvs.engine.init(mvs.response, GLB.channel, GLB.platform, GLB.gameId);\n        if (result !== 0) {\n            console.log('初始化失败,错误码:' + result);\n        }\n        Game.GameManager.blockInput();\n\n    },\n\n    networkStateNotify: function(netNotify) {\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomMedNotify, netNotify);\n    },\n\n    kickPlayerNotify: function(kickPlayerNotify) {\n        var data = {\n            kickPlayerNotify: kickPlayerNotify\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerNotify, data);\n    },\n\n    kickPlayerResponse: function(kickPlayerRsp) {\n        if (kickPlayerRsp.status !== 200) {\n            console.log(\"失败kickPlayerRsp:\" + kickPlayerRsp);\n            return;\n        }\n        var data = {\n            kickPlayerRsp: kickPlayerRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.kickPlayerResponse, data);\n    },\n\n    getRoomListExResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListExResponse, data);\n    },\n\n    getRoomDetailResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 rsp:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomDetailResponse, data);\n    },\n\n    getRoomListResponse: function(status, roomInfos) {\n        if (status !== 200) {\n            console.log(\"失败 status:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomInfos: roomInfos\n        }\n        clientEvent.dispatch(clientEvent.eventType.getRoomListResponse, data);\n    },\n\n    createRoomResponse: function(rsp) {\n        if (rsp.status !== 200) {\n            console.log(\"失败 createRoomResponse:\" + rsp);\n            return;\n        }\n        var data = {\n            rsp: rsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.createRoomResponse, data);\n    },\n\n    joinOverResponse: function(joinOverRsp) {\n        if (joinOverRsp.status !== 200) {\n            console.log(\"失败 joinOverRsp:\" + joinOverRsp);\n            return;\n        }\n        var data = {\n            joinOverRsp: joinOverRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinOverResponse, data);\n    },\n\n    joinRoomResponse: function(status, roomUserInfoList, roomInfo) {\n        if (status !== 200) {\n            console.log(\"失败 joinRoomResponse:\" + status);\n            return;\n        }\n        var data = {\n            status: status,\n            roomUserInfoList: roomUserInfoList,\n            roomInfo: roomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomResponse, data);\n    },\n\n    joinRoomNotify: function(roomUserInfo) {\n        var data = {\n            roomUserInfo: roomUserInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.joinRoomNotify, data);\n    },\n\n    leaveRoomResponse: function(leaveRoomRsp) {\n        if (leaveRoomRsp.status !== 200) {\n            console.log(\"失败 leaveRoomRsp:\" + leaveRoomRsp);\n            return;\n        }\n        var data = {\n            leaveRoomRsp: leaveRoomRsp\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomResponse, data);\n    },\n\n    leaveRoomNotify: function(leaveRoomInfo) {\n        var data = {\n            leaveRoomInfo: leaveRoomInfo\n        }\n        clientEvent.dispatch(clientEvent.eventType.leaveRoomNotify, data);\n    },\n\n    logoutResponse: function(status) {\n        Game.GameManager.network.disconnect();\n        cc.game.removePersistRootNode(this.node);\n        cc.director.loadScene('lobby');\n    },\n\n    errorResponse: function(error, msg) {\n        if (error === 1001) {\n            uiFunc.openUI(\"uiTip\", function(obj) {\n                var uiTip = obj.getComponent(\"uiTip\");\n                if (uiTip) {\n                    uiTip.setData(\"网络断开连接\");\n                }\n            });\n            setTimeout(function() {\n                mvs.engine.logout(\"\");\n                cc.game.removePersistRootNode(this.node);\n                cc.director.loadScene('lobby');\n            }.bind(this), 2500);\n        }\n        console.log(\"错误信息：\" + error);\n        console.log(\"错误信息：\" + msg);\n    },\n\n    initResponse: function() {\n        console.log('初始化成功，开始注册用户');\n        var result = mvs.engine.registerUser();\n        if (result !== 0) {\n            console.log('注册用户失败，错误码:' + result);\n        } else {\n            console.log('注册用户成功');\n        }\n    },\n\n    registerUserResponse: function(userInfo) {\n        var deviceId = 'abcdef';\n        var gatewayId = 0;\n        GLB.userInfo = userInfo;\n\n        console.log('开始登录,用户Id:' + userInfo.id)\n\n        var result = mvs.engine.login(\n            userInfo.id, userInfo.token,\n            GLB.gameId, GLB.gameVersion,\n            GLB.appKey, GLB.secret,\n            deviceId, gatewayId\n        );\n        if (result !== 0) {\n            console.log('登录失败,错误码:' + result);\n        }\n    },\n\n    loginResponse: function(info) {\n        if (info.status !== 200) {\n            console.log('登录失败,异步回调错误码:' + info.status);\n        } else {\n            console.log('登录成功');\n            this.lobbyShow();\n        }\n    },\n\n    lobbyShow: function() {\n        this.gameState = GameState.None;\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiLobbyPanelVer\");\n        } else {\n            uiFunc.openUI(\"uiLobbyPanel\");\n        }\n    },\n\n    // 玩家行为通知--\n    sendEventNotify: function(info) {\n        var cpProto = JSON.parse(info.cpProto);\n\n        if (info.cpProto.indexOf(GLB.GAME_START_EVENT) >= 0) {\n            var remoteUserIds = JSON.parse(info.cpProto).userIds;\n            // 分队--\n            if (remoteUserIds.length % 2 !== 0) {\n                return console.log(\"人数不为偶数, 无法开战！\");\n            }\n            var selfCamp = 0;\n            var index;\n            for (index = 0; index < remoteUserIds.length; index++) {\n                if (GLB.userInfo.id === remoteUserIds[index]) {\n                    if (index < remoteUserIds.length / 2) {\n                        selfCamp = 0;\n                    } else {\n                        selfCamp = 1;\n                    }\n                    break;\n                }\n            }\n            this.enemyIds = [];\n            this.friendIds = [GLB.userInfo.id];\n            for (index = 0; index < remoteUserIds.length; index++) {\n                var camp = 0;\n                if (index < remoteUserIds.length / 2) {\n                    camp = 0;\n                } else {\n                    camp = 1;\n                }\n                if (camp === selfCamp) {\n                    if (remoteUserIds[index] !== GLB.userInfo.id) {\n                        this.friendIds.push(remoteUserIds[index]);\n                    }\n                } else {\n                    this.enemyIds.push(remoteUserIds[index]);\n                }\n            }\n            GLB.playerUserIds = this.friendIds.concat(this.enemyIds);\n            console.log(\"remoteUserIds:\" + remoteUserIds);\n            console.log(\"GLB.playerUserIds:\" + GLB.playerUserIds);\n\n            this.startGame();\n        }\n\n        var player = null;\n        if (info.cpProto.indexOf(GLB.PLAYER_FLY_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.flyNotify();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_FIRE_EVENT) >= 0) {\n            for (var i = 0; i < GLB.playerUserIds.length; i++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[i]);\n                if (player) {\n                    for (var j = 0; j < cpProto.data.length; j++) {\n                        if (cpProto.data[j].playerId === player.userId) {\n                            player.fireNotify(cpProto.data[j].bulletPointY);\n                        }\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.NEW_ITEM_EVENT) >= 0) {\n            Game.ItemManager.spawnItemNotify(cpProto);\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_GET_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n            if (player) {\n                player.getItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_REMOVE_ITEM_EVENT) >= 0) {\n            player = Game.PlayerManager.getPlayerByUserId(info.srcUserId);\n            if (player) {\n                player.removeItemNotify(cpProto);\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.PLAYER_HURT_EVENT) >= 0) {\n            if (Game.GameManager.gameState !== GameState.Over) {\n                player = Game.PlayerManager.getPlayerByUserId(cpProto.playerId);\n                if (player) {\n                    player.hurtNotify(cpProto.murderId);\n                }\n                // 检查回合结束--\n                var loseCamp = Game.PlayerManager.getLoseCamp();\n                if (loseCamp != null) {\n                    Game.GameManager.gameState = GameState.Over\n                    if (GLB.isRoomOwner) {\n                        this.sendRoundOverMsg(loseCamp);\n                    }\n                }\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            // 如果发送方为敌方--\n            var loseCamp1 = cpProto.loseCamp;\n            if (this.friendIds.indexOf(info.srcUserId) < 0) {\n                if (loseCamp1 === Camp.Friend) {\n                    loseCamp1 = Camp.Enemy;\n                } else if (loseCamp1 === Camp.Enemy) {\n                    loseCamp1 = Camp.Friend;\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: loseCamp1});\n        }\n\n        if (info.cpProto.indexOf(GLB.ROUND_START) >= 0) {\n            Game.GameManager.gameState = GameState.Play;\n            clientEvent.dispatch(clientEvent.eventType.roundStart);\n        }\n\n        if (info.cpProto.indexOf(GLB.READY) >= 0) {\n            this.readyCnt++;\n            if (GLB.isRoomOwner && this.readyCnt >= GLB.playerUserIds.length) {\n                this.sendRoundStartMsg();\n            }\n        }\n\n        if (info.cpProto.indexOf(GLB.TIME_OVER) >= 0) {\n            Game.GameManager.gameState = GameState.Over;\n            for (var m = 0; m < GLB.playerUserIds.length; m++) {\n                player = Game.PlayerManager.getPlayerByUserId(GLB.playerUserIds[m]);\n                if (player) {\n                    player.dead();\n                }\n            }\n            clientEvent.dispatch(clientEvent.eventType.roundOver, {loseCamp: Camp.None});\n        }\n    },\n\n    sendEventEx: function(msg) {\n        var result = mvs.engine.sendEventEx(0, JSON.stringify(msg), 0, GLB.playerUserIds);\n        if (result.result !== 0) {\n            console.log(msg.action, result.result);\n        }\n    },\n\n    getRankDataListener: function() {\n        this.network.on(\"connector.rankHandler.getRankData\", function(recvMsg) {\n            uiFunc.openUI(\"uiRankPanelVer\", function(obj) {\n                var uiRankPanel = obj.getComponent(\"uiRankPanel\");\n                uiRankPanel.setData(recvMsg.rankArray);\n            });\n        }.bind(this));\n    },\n\n    findPlayerByAccountListener: function() {\n        this.network.on(\"connector.entryHandler.findPlayerByAccount\", function(recvMsg) {\n            clientEvent.dispatch(clientEvent.eventType.playerAccountGet, recvMsg);\n        });\n    },\n\n    loginServer: function() {\n        if (!this.network.isConnected()) {\n            this.network.connect(GLB.IP, GLB.PORT, function() {\n                    this.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        this.network.send(\"connector.rankHandler.updateScore\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game0\"\n                        });\n                    }.bind(this), 500);\n\n                }.bind(this)\n            );\n        } else {\n            this.network.send(\"connector.rankHandler.updateScore\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game0\"\n            });\n        }\n    },\n\n    userInfoReq: function(userId) {\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                            \"account\": userId + \"\",\n                        });\n                    }, 200);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.entryHandler.findPlayerByAccount\", {\n                \"account\": userId + \"\",\n            });\n        }\n    },\n\n    onDestroy() {\n        clientEvent.off(clientEvent.eventType.roundOver, this.roundOver, this);\n    }\n});\n"]}